{% extends "operacoes/base.html" %}

{% block title %}Entrega{% endblock %}

{% block content %}
<div class="container py-3">

  <!-- Cabeçalho -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h2 class="mb-0">Entrega do Lote</h2>
      <div class="text-muted">
        Data: <strong>{{ lote.data_entrega|date:"d/m/Y" }}</strong> —
        Benefício: <strong>{{ lote.beneficio.nome }}</strong>
        &nbsp;|&nbsp; Lote: <strong>#{{ lote.id }}</strong>
      </div>
    </div>

    <div class="d-flex gap-2">
      <!-- Imprimir (Lista de chamada) -->
      <a class="btn btn-outline-dark"
           href="{% url 'entregas:lote_print' lote.id %}"
          target="_blank">
          <i class="bi bi-printer"></i> Imprimir
      </a>
              

      <!-- Voltar -->
      <a class="btn btn-outline-secondary" href="{% url 'entregas:lote_lista' %}">
        <i class="bi bi-arrow-left"></i> Voltar
      </a>
    </div>
  </div>

  <!-- Card resumo -->
  <div class="card shadow-sm mb-3">
    <div class="card-body d-flex gap-2 flex-wrap">
      <span class="badge text-bg-primary">Total: {{ total }}</span>
      <span class="badge text-bg-success">Entregues: {{ entregues }}</span>
      <span class="badge text-bg-secondary">Pendentes: {{ pendentes }}</span>
    </div>
  </div>

  <!-- Card checklist -->
  <div class="card shadow-sm">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}

        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th style="width:70px;">OK</th>
                <th>Nome</th>
                <th style="width:180px;">Telefone</th>
                <th style="width:140px;">Data Nasc.</th>
              </tr>
            </thead>

            <tbody>
              {% for item in itens %}
              <tr>
                <td>
                  <input class="form-check-input"
                         type="checkbox"
                         name="entregue"
                         value="{{ item.id }}"
                         {% if item.entregue %}checked{% endif %}>
                </td>

                <td>
                  {{ item.atribuicao.assistido.nome|title }}
                </td>

                <td>
                  {{ item.atribuicao.assistido.telefone_formatado }}
                </td>

                <td>
                  {{ item.atribuicao.assistido.data_nascimento|date:"d/m/Y" }}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-muted">
                  Nenhum assistido encontrado para este lote.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <button type="submit" class="btn btn-primary mt-2">
          <i class="bi bi-save"></i> Salvar checklist
        </button>
      </form>
    </div>
  </div>

</div>
{% endblock %}
